---
title: "Sequence Learning Post Touch Screen"
author: "Chelsea Harmon"
date: "7/18/2018 updated 10/02/2018 updated 12/17/18 updated 1/17/19 revisited 5/11/2020, added to 1/19/22"
output:
  html_document: 
    toc: yes
    toc_float: 
      smooth_scross: true
      collapsed: false 
    number_sections: true  
  word_document: default
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(tidyverse)
library(broom)
library(ggplot2)
library(plyr)
library(dplyr)
library(tidyr)
knitr::opts_chunk$set(echo = T, cache = F, tidy = F, warning = F, message = F)  # Code not shown by default

# Set global ggplot theme
theme_set(theme_bw() + theme(panel.grid = element_blank(),
                             strip.text = element_blank(),
                             strip.background = element_blank(),
                             legend.position = "none"))
```

#Getting Data From data Folder output from Psychopy 

```{r,include=FALSE}

all.file.names <- list.files(path = "/Users/chelseaharmon/Dropbox/danlab/Tasks/motorSequenceLearning/sequenceLearning/data/V1W1", pattern = ".csv")
length(all.file.names)
#all.file.names
#517 files 

#write.table(all.file.names, file = "all.file.namesV1W1_11.17.21.txt", quote = F, row.names = F, col.names = F, sep = ",")

all.file.path.names <- 1:length(all.file.names)
for(i in 1:length(all.file.names)){all.file.path.names[i] <- paste("/Users/chelseaharmon/Dropbox/danlab/Tasks/motorSequenceLearning/sequenceLearning/data/V1W1/",all.file.names[i], sep='')
}

#write.table(all.file.path.names, file = "all.file.pathsV1W1_11.17.21.txt", quote = F, row.names = F, col.names = F, sep = ",")

data.list.all <- list()
length(all.file.path.names)


for(i in 1:length(all.file.path.names)){
# assign data frame for each csv file and save it in the list of dataframes.
data.list.all[[i]] <- data.frame(read.csv(all.file.path.names[i], stringsAsFactors=T))
}

all.subject.list <- substr(all.file.names, start=1, stop=5)


#finding the biggest file output 
finding.longest.file <- data.frame(1:length(data.list.all))
for(i in 1:length(data.list.all)){
  finding.longest.file[i, 1] <- (all.subject.list[i])
  finding.longest.file[i, 2] <- (all.file.names[i])
  finding.longest.file[i, 3] <- (length(data.list.all[[i]]$participant))}


finding.longest.file <- 
  finding.longest.file[
  order(finding.longest.file[,1], -finding.longest.file[,3]),
]

use.these.data.files <- finding.longest.file[!duplicated(finding.longest.file$X1.length.data.list.),2]
W1.subject.list <- substr(use.these.data.files, start=1, stop=5)
length(W1.subject.list)
#(W1.subject.list)
#242

W1.use.these.data.files <- use.these.data.files

#write.table(W1.use.these.data.files, file = "file.namesV1W1_11.16.21.txt", quote = F, row.names = F, col.names = F, sep = ",")


W1.file.path.names <- 1:length(W1.use.these.data.files)
W1.file.path.names

for(i in 1:length(W1.use.these.data.files)){W1.file.path.names[i] <- paste("/Users/chelseaharmon/Dropbox/danlab/Tasks/motorSequenceLearning/sequenceLearning/data/V1W1/",use.these.data.files[i], sep='')
}

length(W1.file.path.names)

#write.table(W1.file.path.names, file = "file.pathsV1W1_11.17.21.txt", quote = F, row.names = F, col.names = F, sep = ",")

```

#Grabbing Wave 2 data 
```{r,include=FALSE}

W2.all.file.names <- list.files(path = "/Users/chelseaharmon/Dropbox/danlab/Tasks/motorSequenceLearning/sequenceLearning/data/V2W2", pattern = ".csv")
length(W2.all.file.names)
#101

#write.table(all.file.names, file = "all.file.namesV2W2_11.17.21.txt", quote = F, row.names = F, col.names = F, sep = ",")

W2.all.file.path.names <- 1:length(W2.all.file.names)
for(i in 1:length(W2.all.file.names)){W2.all.file.path.names[i] <- paste("/Users/chelseaharmon/Dropbox/danlab/Tasks/motorSequenceLearning/sequenceLearning/data/V2W2/",W2.all.file.names[i], sep='')
}

#write.table(all.file.path.names, file = "all.file.pathsV2W2_05.17.20.txt", quote = F, row.names = F, col.names = F, sep = ",")

W2.data.list.all <- list()

for(i in 1:length(W2.all.file.path.names)){
# assign data frame for each csv file and save it in the list of dataframes.
W2.data.list.all[[i]] <- data.frame(read.csv(W2.all.file.path.names[i], stringsAsFactors=T))
}

W2.all.subject.list <- substr(W2.all.file.names, start=1, stop=5)
length(W2.all.subject.list)

#finding the biggest file output 
W2.finding.longest.file <- data.frame(1:length(W2.data.list.all))
for(i in 1:length(W2.data.list.all)){
  W2.finding.longest.file[i, 1] <- (W2.all.subject.list[i])
  W2.finding.longest.file[i, 2] <- (W2.all.file.names[i])
  W2.finding.longest.file[i, 3] <- (length(W2.data.list.all[[i]]$participant))}


W2.finding.longest.file <- 
  W2.finding.longest.file[
  order(W2.finding.longest.file[,1], -W2.finding.longest.file[,3]),
]
head(W2.finding.longest.file)
W2.use.these.data.files <- W2.finding.longest.file[!duplicated(W2.finding.longest.file$X1.length.W2.data.list.),2]
#View(finding.longest.file)
W2.subject.list <- substr(W2.use.these.data.files, start=1, stop=5)
W2.subject.list
#W2.use.these.data.files
length(W2.subject.list)
#48

#write.table(W2.use.these.data.files, file = "file.namesV2W2_11.17.21.txt", quote = F, row.names = F, col.names = F, sep = ",")


W2.file.path.names <- 1:length(W2.use.these.data.files)
for(i in 1:length(W2.use.these.data.files)){W2.file.path.names[i] <- paste("/Users/chelseaharmon/Dropbox/danlab/Tasks/motorSequenceLearning/sequenceLearning/data/V2W2/",W2.use.these.data.files[i], sep='')
}
length(W2.file.path.names)

#write.table(W2.file.path.names, file = "file.pathsV2W2_11.16.21.txt", quote = F, row.names = F, col.names = F, sep = ",")
```


#Making sepearte csv with demographcis or W1 and W2 
```{r}
#wave 1
length(W1.file.path.names)
#242
taskData <- read.csv((W1.file.path.names[1]), stringsAsFactors = F)

W1.file.path.names <- W1.file.path.names[-1]
W1.use.these.data.files <- W1.use.these.data.files[-1]


for(i in 1:length(W1.file.path.names)){
  subData <- read.csv(W1.file.path.names[i])
  taskData <- plyr::rbind.fill(taskData, subData)
}

length(unique(taskData$participant))



#renaming subjects who were mis-entered 
taskData$participant[taskData$participant=="PA101"] <- 101
taskData$participant[taskData$participant=="PA246"] <- 246
taskData$participant[taskData$participant=="PA325"] <- 325
taskData$participant[taskData$participant=="PA326"] <- 326
taskData$participant[taskData$participant=="PA246"] <- 246
#taskData$participant[taskData$participant=="PA008"] <- 8
#taskData$participant[taskData$participant=="PA010_V2W2"] <- 10
#taskData$participant[taskData$participant=="PA025"] <- 25
#taskData$participant[taskData$participant=="pa034"] <- 34
#taskData$participant[taskData$participant=="PA070_V2W2"] <- 70

write.csv(taskData, file= "Wave1RawData_12.03.21.csv", row.names = F)

```

#Wave 1 
```{r}

W1.demo <- read.csv("MASTER_W1_20210223.csv")

W1.demo <- W1.demo[,c("IDENT_SUBID", "GROUP", "SUBAGE_Session1","DEM_3_GENDER_CHILD","DEM_FINAL_CHILD_RACE", "SCHOOLGRADE")]

names(W1.demo)
#CGH_SUM_SWITCHES #looking for these variables in the document
#CGH_AGE_EARLY#looking for these variables in the document

W1.demo$participant <- substr(W1.demo$IDENT_SUBID, start=3, stop=5)
W1.demo$participant <- as.numeric(sub("^0+", "", W1.demo$participant))

unique(W1.demo$IDENT_SUBID)
W1_data_withDEMO <- merge(W1.demo, taskData, by="participant")

unique(W1_data_withDEMO$participant)==unique(taskData$participant)
length(unique(W1_data_withDEMO$participant))
length(unique(taskData$participant))
W1_data_withDEMO[W1_data_withDEMO$participant==225,]

#No demographics from wave 1 for PA227 PA228 PA229 
#N=239 in demographics and N=242 for subject data

#write.csv(W1_data_withDEMO, file= "W1_data_withDEMO_11.16.21.csv", row.names = F)
```

#Wave 2

```{r}

W2.file.path.names
taskData <- read.csv((W2.file.path.names[1]), stringsAsFactors = F)

W2.file.path.names <- W2.file.path.names[-1]
W2.use.these.data.files <- W2.use.these.data.files[-1]


for(i in 1:length(W2.file.path.names)){
  subData <- read.csv(W2.file.path.names[i])
  taskData <- plyr::rbind.fill(taskData, subData)
}


W2.demo <- read.csv("MASTER_W2_20200417.csv")
head(W2.demo)
W2.demo <- W2.demo[,c("IDENT_SUBID", "GROUP","SUBAGE_Session2", "SCHOOLGRADE", "DEM_1_DATESESS2")] #"DEM_FINAL_CHILD_RACE", missing from W2 so much retrieve from wave 1 demos 
W2.demo$participant <- substr(W2.demo$IDENT_SUBID, start=3, stop=5)
W2.demo$participant <- as.numeric(sub("^0+", "", W2.demo$participant))
unique(W2.demo$participant)

length(unique(taskData$participant))


#taskData$participant[taskData$participant=="PA101"] <- 101
#taskData$participant[taskData$participant=="PA246"] <- 246
#taskData$participant[taskData$participant=="PA325"] <- 325
#taskData$participant[taskData$participant=="PA326"] <- 326
#taskData$participant[taskData$participant=="PA246"] <- 246
taskData$participant[taskData$participant=="PA008"] <- 8
taskData$participant[taskData$participant=="PA010_V2W2"] <- 10
taskData$participant[taskData$participant=="PA025"] <- 25
taskData$participant[taskData$participant=="pa034"] <- 34
taskData$participant[taskData$participant=="PA070_V2W2"] <- 70


write.csv(taskData, file= "Wave2RawData_12.03.21.csv", row.names = F)


W2_data_withDEMO<- merge(W2.demo, taskData)

unique(W2_data_withDEMO$participant)==unique(taskData$participant)


length(unique(W2_data_withDEMO$participant))
#48 participants in Wave 2 
W2_data_withDEMO[W2_data_withDEMO$participant==69,]

write.csv(W2_data_withDEMO, file= "W2_data_withDEMO_11.16.21.csv", row.names = F)

```



#Making csv with all subjects data

```{r, include=FALSE}
#Because thius was run aleady we can load the data at the bottom of this code chunk 
#
# #taskData1 <- read.csv((file.path.names[1]), stringsAsFactors = F)
# 
# #file.path.names[1]
# #taskData <- read.csv((file.path.names[1]), stringsAsFactors = F)
# all.use.these.data.files <- c(W1.use.these.data.files,W2.use.these.data.files)
# 
# #write.table(all.use.these.data.files, file = "all.file.names_11.16.21.txt", quote = F, row.names = F, col.names = F, sep = ",")
# (all.use.these.data.files)
# length(W1.use.these.data.files) 
# length(W2.use.these.data.files)
# 
# 242+48
# 
# both.waves.file.path.name <- c(W1.file.path.names, W2.file.path.names)
# #write.table(both.waves.file.path.name, file = "all.file.paths_11.16.21.txt", quote = F, row.names = F, col.names = F, sep = ",")
# 
# length(both.waves.file.path.name)
# 
# #write.table(both.waves.file.path.name, file = "both.waves.file.paths_11.16.21.txt", quote = F, row.names = F, col.names = F, sep = ",")
# 
# taskData <- read.csv((both.waves.file.path.name[1]), stringsAsFactors = F)
# 
# both.waves.file.path.name <- both.waves.file.path.name[-1]
# all.use.these.data.files <- all.use.these.data.files[-1]
# 
# 
# #dirTask <- "/Users/chelseaharmon/Dropbox/danlab/Tasks/motorSequenceLearning/sequenceLearning/data/V1W1/"
# #use.these.data.files <- use.these.data.files[-1]
# all.use.these.data.files
# both.waves.file.path.name
# 
# 
# for(i in 1:length(both.waves.file.path.name)){
#   subData <- read.csv(both.waves.file.path.name[i])
#   taskData <- plyr::rbind.fill(taskData, subData)
# }
# 
# 
# length(taskData)
# length(unique(taskData$participant))
# (unique(taskData$participant))
# (length(unique(taskData$participant)))
# 
#
##Renaming strangely named participants 
# taskData$participant[taskData$participant=="PA101"] <- 101
# taskData$participant[taskData$participant=="PA246"] <- 246
# taskData$participant[taskData$participant=="PA325"] <- 325
# taskData$participant[taskData$participant=="PA326"] <- 326
# taskData$participant[taskData$participant=="PA246"] <- 246
# taskData$participant[taskData$participant=="PA008"] <- 008
# taskData$participant[taskData$participant=="PA010_V2W2"] <- 010
# taskData$participant[taskData$participant=="PA025"] <- 025
# taskData$participant[taskData$participant=="pa034"] <- 034
# taskData$participant[taskData$participant=="PA070_V2W2"] <- 070
# 
# #repeated data PA006 PA031 PA058 PA059 PA060 PA061 PA069
# 
# names(taskData)

#write.csv(taskData, file= "all.subject.task.data_11.16.21.csv", row.names = F)
taskData <- read.csv("all.subject.task.data_11.16.21.csv")
length(unique(taskData$participant))

count(taskData$participant)

View(taskData)
```


#Seperatng touch screen 
```{r}
#View(taskData[taskData$allowableKey=="['num_7', 'num_4', 'num_1', 'num_0']",])
#taskData$preTouchScreen <- ifelse(taskData$allowableKey=="['num_7', 'num_4', 'num_1', 'num_0']", 1, 0)
#taskData$expName

#unique(taskData$preTouchScreen)
#table(taskData$preTouchScreen, taskData$allowableKey)

#taskData$preTouchScreen <- 1
#taskData$preTouchScreen[is.na(taskData$correctLocation)] <- 1
#taskData$preTouchScreen[!is.na(taskData$correctLocation)] <- 0

#Filter out non usable data 
#Those that were run with incorrect order (sequence, random, random, sequence)
#PA098 PA127 PA136 PA086
#View(taskData)

taskData <- taskData[!taskData$participant=="98",]
taskData <- taskData[!taskData$participant=="127",]
taskData <- taskData[!taskData$participant=="136",]
taskData <- taskData[!taskData$participant=="86",]


length(unique(taskData$participant))


#Task Data Touch Screen seperate data frame - possibly save this for later 
#taskDataTouch <- taskData[complete.cases(taskData$correctLocation), ]
#taskDataTouchCheck <- taskData[taskData$preTouchScreen ==1,]

#unique(taskDataTouch$participant)
#unique(taskDataTouchCheck$participant)

unique(taskData$date)
taskData$date1 <- substr(taskData$date, start=1, stop=11)
taskData$date1 
taskData$date1 <- as.Date(taskData$date1, format = ("%Y_%b_%d"))
class(taskData$date1)

taskData$PreTouchByDate<- ifelse(taskData$date1 > "2018-06-12", 0, 1)
unique(taskData$participant)

unique(taskData$participant[taskData$PreTouchByDate==1])
unique(taskData$participant[taskData$PreTouchByDate==0])
length(unique(taskData$participant[taskData$PreTouchByDate==1]))
length(unique(taskData$participant[taskData$PreTouchByDate==0]))

taskDataTouch <- taskData[taskData$PreTouchByDate==1,]
taskData <- taskData[taskData$PreTouchByDate==0,]

(unique(taskDataTouch$participant))
length(unique(taskData$participant))
head(taskDataTouch)

#write.csv(taskData, file= "post_touchscreen.task.data_11.16.21.csv", row.names = F)
#write.csv(taskDataTouch, file= "pre_touchscreen.task.data_11.16.21.csv", row.names = F)

```


#Cleaning touch screen data 
```{r}

#head(taskDataTouch)
#names(taskDataTouch)

#Making new file with quesitons 
#questionsResponsesTouch <- taskDataTouch[!complete.cases(taskDataTouch$stimulusPresent.t), ]
#taskDataTouch <- taskDataTouch[complete.cases(taskDataTouch$stimulusPresent.t), ]

#taskDataTouch$keyResponse <- as.character(taskDataTouch$key_resp_9.keys)
#taskDataTouch$keyResponseTimes <- as.character(taskDataTouch$key_resp_9.rt)

#unique(taskDataTouch)

#Touch screen columns 
#taskDataTouch <- subset(taskDataTouch, select=c('participant', 'date', 'stimulusPresent.t', 'responseTimeCorrect', 'responseTimeIncorrect', 'trialIncorrect', 'correctLocation', 'pressLoc', 'anticipatoryResponse', 'preTouchScreen')) #


#table(taskData$participant, taskData$correctLocation)
#table(taskData$participant, taskData$preTouchScreen)
#table(taskData$participant, taskData$preTouchScreen)

#unique(taskDataTouch$participant)
#unique(taskData$date)
#taskDataDateSep <- separate(data = taskData, col = date, into = c("Year", "Month", "Day", "Time"), sep = "\\_")
#taskDataDateSep$Year
#unique(taskDataAll$preTouchScreen)


#taskData$trialIncorrect[is.na(taskData$trialIncorrect)] <- 0
#taskData$anticipatoryResponse[is.na(taskData$anticipatoryResponse)] <- 0

#taskData$trialCorrect <- taskData$trialIncorrect + 1
#taskData$trialCorrect[taskData$trialCorrect==2] <- 0

```
#Clearning pre touch screen data 

```{r}
taskDataPreTouch <- read.csv("pre_touchscreen.task.data_11.16.21.csv")

(unique(taskDataPreTouch$repetitionNumber))



(unique(taskDataPreTouch$repeitionNumber))
#View(taskDataPreTouch)
unique(taskDataPreTouch$thisRepN)
#Pre Touch screen columns 

#Seperating out questionnaire data 
unique(taskDataPreTouch$trials_questions.thisRepN)
#taskDataPreTouch[taskDataPreTouch$trials_questions.thisRepN==0,]


questionnaireDataPreTouch<- taskDataPreTouch %>% 
  filter(taskDataPreTouch$trials_questions.thisRepN==0) %>% 
  subset(select=c('participant', 'date1', 'stimulusPresent.t', 'correctKey', 'keyRespCorrect', 'correctKeyPressNum', 'key_resp_9.rt', 'key_resp_9.keys', 'trialCorrect', 'repetitionNumber', 'anticipatoryResponse', 'PreTouchByDate', 'recallResponse', 'recallResponseTime', 'RecordAnswer.rt', 'RecordAnswer.keys', 'questionsResponses')) 


taskDataPreTouch <- taskDataPreTouch %>% 
  filter(taskDataPreTouch$stimulusPresent.t>0) %>% 
  subset(select=c('participant', 'date1', 'stimulusPresent.t', 'correctKey', 'keyRespCorrect', 'correctKeyPressNum', 'key_resp_9.rt', 'key_resp_9.keys', 'trialCorrect', 'repetitionNumber', 'anticipatoryResponse', 'PreTouchByDate')) #


```

#seperating data into blocks, pre touch screen 

```{r}

unique(taskDataPreTouch$participant)[2]


length(unique(taskDataPreTouch$participant))

table(taskDataPreTouch$participant)

#for(i in 1:length(unique(taskDataPreTouch$participant))){
#  taskDataPreTouch$TrialNum <- 
#  taskDataPreTouch[taskDataPreTouch$participant==unique(taskDataPreTouch$participant)[2],]

#}


taskDataPreTouch$TrialNum <- sequence(rle(taskDataPreTouch$participant)$lengths)



#excluding incomplete data, excluding subjects 58 (for 2 blocks), 60 (for 1 block), 73 (for 1 block), 80 (for 2 blocks), 82 (for not completing 1 full block), 84 (for 1 block), 93 (for not completing block 3) = 7 subjects 
taskDataPreTouch$participant

taskDataPreTouch <- taskDataPreTouch %>% 
  filter(!participant %in% c(58, 60, 73, 80, 82, 84, 93))

#in group analyses is it okay to keep those who did not complete the task, or should we only complete full data? - ask Paul, statistical question 


unique(taskDataPreTouch$participant)
length(unique(taskDataPreTouch$participant))
unique(taskData$participant)

#repeated in pre and post touch screen - 6, 



```


#seperating pre touch screen into Blocks 
```{r}

taskDataPreTouchBlocks1 <- taskDataPreTouch 
#taskDataPreTouchBlocks1$Group <-  taskDataPreTouchBlocks1$Trial

#Post Touch screen has sequence length 8 for 10 sequences per block 
taskDataPreTouchBlocks1$Group1 <- taskDataPreTouchBlocks1$TrialNum <= 80 #100 
taskDataPreTouchBlocks1$Group2 <- between(taskDataPreTouchBlocks1$Trial, 81, 160)  #101,  200 ) 
taskDataPreTouchBlocks1$Group3 <- between(taskDataPreTouchBlocks1$Trial, 161, 240) #201,  300 ) 
taskDataPreTouchBlocks1$Group4 <- between(taskDataPreTouchBlocks1$Trial, 241, 320)   #301,  400 ) 

taskDataPreTouchBlocks1$Group[taskDataPreTouchBlocks1$Group1 == TRUE] <- "Block1"
taskDataPreTouchBlocks1$Group[taskDataPreTouchBlocks1$Group2 == TRUE] <- "Block2"
taskDataPreTouchBlocks1$Group[taskDataPreTouchBlocks1$Group3 == TRUE] <- "Block3"
taskDataPreTouchBlocks1$Group[taskDataPreTouchBlocks1$Group4 == TRUE] <- "Block4"
Group <- taskDataPreTouchBlocks1$Group

taskDataPreTouch <- (cbind(taskDataPreTouch, Group))
head(taskDataPreTouch)
unique(taskDataPreTouch$Group)
names(taskDataPreTouch)

#write.csv(taskDataPreTouch, "dataPreTouchCleaned1.19.2022.csv", row.names=F)

table(taskDataPreTouch$participant, taskDataPreTouch$Group)

#What are anticipatory responses that are incorrect??? 

```





#Cleaning post touch screen data 
```{r, include=FALSE}
taskData <- read.csv("post_touchscreen.task.data_11.16.21.csv")
head(taskData)


unique(taskData$participant)

#These are post touch screen answers 
#taskData <- taskData %>% select(-c('responseTimeCorrect', 'responseTimeIncorrect', 'trialIncorrect', 'correctLocation', 'pressLoc', 'anticipatoryResponse', 'correctImage'))

subject75data <- taskData[(taskData$participant==75),]
#View(subject75data)
length(subject75data$repetitionNumber)

subject6data <- taskData[(taskData$participant==6),]
length(subject75data$repetitionNumber)

subject31data <- taskData[(taskData$participant==31),]
length(subject75data$repetitionNumber)

table(taskData$participant, taskData$pawPatrol1) >337
table(taskData$participant, taskData$pawPatrol1) 

#incomplete data subject numbers 45, 112, 236, 253, 259, 274, 311, 317 ??????????????????????????
#subjects who completed post touch screen twice 3, 31
```


#seperating data into Blocks 
```{r}

taskData$repetitionNumber


taskData$TrialNum <- sequence(rle(taskData$participant)$lengths)

unique(taskData$TrialNum)


# taskDataNoOutliers <- taskData[taskData$responseTimeCorrect < 100,]
# 
# ggplot(data=taskDataNoOutliers, aes(TrialNum, responseTimeCorrect, group=participant, color=participant)) + 
#   geom_point() + 
#   geom_line()
# 
# summaryAllValues <- taskData %>% 
#   group_by(participant, Group) %>%
#   summarise_at(vars(trialCorrect), funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))
# 
# 337/4
# taskData$Block <-rep(1:8, length=nrow(x))
# 
# library(dplyr)
# taskData %>% 
#  group_by(participant) %>% 
#  mutate(Block= c(rep(1:8)))
# 
# 
# taskData %>% 
#   group_by(participant) %>% 
#   mutate(num_in_group=seq_along(repetitionNumber)) %>% 
#   as.data.frame
# 
# df %>%
#  group_by(cat) %>%
#  mutate(num = 1:n())
# taskDataBlocks1 <- ddply(taskData, .(participant), mutate, Trial = seq_along(repetitionNumber))


#taskData$Trial <- c(1:length(taskData$repetitionNumber))
#taskDataBlocks1 <- ddply(taskData, .(participant), mutate, Trial = seq_along(repetitionNumber))
taskDataBlocks1 <- taskData
#taskDataBlocks1$Group <-  taskDataBlocks1$Trial

#Post Touch screen has sequence length 8 for 10 sequences per block 
taskDataBlocks1$Group1 <- taskDataBlocks1$TrialNum <= 80 #100
taskDataBlocks1$Group2 <- between(taskDataBlocks1$Trial, 81, 160)  #101,  200 ) 
taskDataBlocks1$Group3 <- between(taskDataBlocks1$Trial, 161, 240) #201,  300 ) 
taskDataBlocks1$Group4 <- between(taskDataBlocks1$Trial, 241, 320)   #301,  400 ) 

taskDataBlocks1$Group[taskDataBlocks1$Group1 == TRUE] <- "Block1"
taskDataBlocks1$Group[taskDataBlocks1$Group2 == TRUE] <- "Block2"
taskDataBlocks1$Group[taskDataBlocks1$Group3 == TRUE] <- "Block3"
taskDataBlocks1$Group[taskDataBlocks1$Group4 == TRUE] <- "Block4"
Group <- taskDataBlocks1$Group

taskData <- (cbind(taskData, Group))
head(taskData)
unique(taskData$Group)
names(taskData)
length(unique(taskData$participant))

unique(taskData$participant)

#write.csv(taskData, "dataPostTouchCleaned1.15.2019.csv", row.names=F)



table(taskData$participant, taskData$Group)

#What are anticipatory responses that are incorrect??? 
```

#Merging pre and post touch data 

```{r}
taskData
taskDataPreTouch

```


##EXCLUDE THIS FOR NOW AND COME BACK AND CHECK ON THESE SUBJECTS - SKIP TO NEXT SECTION
#Checking for complete Blocks
```{r}
#CONTROL + SHIFT + C

# #excluding particpants who dont have complete data
# blocksCompleted = rep(1,length(unique(taskData$participant)))
# blocksAccum = rep(1,length(unique(taskData$participant)))
# 
# 
# subject1 = as.character(taskData$participant[1])
# blocksCompleted[1] <- sum(taskData$participant==subject1)
# library(dplyr)
# 
# subjectList <- (distinct(taskData, participant))
# subj2 <- as.character(subjectList$participant)
# 
# for(i in 1:length(subj2)){
#   blocksCompleted[i] <- sum(taskData$participant==subj2[[i]])
# }
# 
# #blocksLength
# blocksLength <- rbind(subj2, blocksCompleted)
# #blocksLength[blocksLength$blocksCompleted < 4,]
# blocksLength
# 
# sum(blocksCompleted<320) # 1 subject does not have comlete data
# 
# 
# length(subj2) #32 subjects 7/13
# length(subj2) #67 subjects 10/02
# 
# taskData$participant <- as.factor(taskData$participant)
```


##For now remove subjects that are fishy and come back for them later 

#Removing
112      0      0     80     80
#245    160     80     80      0 check 
253      0      0      0     80
#301    160    160      0      0 #check
#308     87     73     80     80 #check
317      0      0      0      7
#89     160    160      0      0 #check
311      0      7     80     73

#Remove outliers  
```{r}
taskData <- taskData[!taskData$participant=='112',] #2 blocks only 
#taskData <- taskData[!taskData$participant=='245',]  #check 
taskData <- taskData[!taskData$participant=='253',] #has only 1 block
#taskData <- taskData[!taskData$participant=='301',] #check looks fine
#taskData <- taskData[!taskData$participant=='308',] #check looks fine
taskData <- taskData[!taskData$participant=='317',] 
#taskData <- taskData[!taskData$participant=='89',] #check looks fine 
taskData <- taskData[!taskData$participant=='311',] #only 2 trials

length(unique(taskData$participant))

#write.csv(taskData, "dataPostTouchCleaned1.15.2019.csv", row.names=F)

table(taskData$participant, taskData$Group)
#View(taskData)
```




#Demographics by group 
```{r}
names(taskData)
length(unique(taskData$participant))

W1.demo <- read.csv("MASTER_W1_20210223.csv")
head(W1.demo)

W2.demo <- read.csv("MASTER_W2_20200417.csv")
head(W2.demo)




```





#Plotting Incorrect Data 
```{r}

library(ggplot2)
library(dplyr)
options(digits=5)
head(taskData)
unique(taskData$Group)
summaryAllValues <- taskData %>% 
  group_by(participant, Group) %>%
  summarise_at(vars(trialCorrect), funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summaryAllValues <- as.data.frame(summaryAllValues)

(summaryAllValues)


summaryAllValues$participant <- as.factor(summaryAllValues$participant)

summaryAllValues$trialCorrect <- formatC(summaryAllValues$trialCorrect, digits = 2, format = "f")
summaryAllValues$trialCorrect<-as.numeric(summaryAllValues$trialCorrect)

summaryAllValues
ACCRaw <- ggplot(data=summaryAllValues, 
       aes(Group, mean, group=participant, color=participant)) + 
  geom_point() + 
  geom_line() + 
  theme_classic() +
  geom_hline(yintercept=.5, linetype="dashed") + 
  theme(legend.position = "none")

ACCRaw

```



Plots Continued 
```{r}

summaryAllValues <- taskData %>% 
  group_by(participant, Group, preTouchScreen) %>%
  summarise_at(vars(trialCorrect),funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summaryAllValues <- as.data.frame(summaryAllValues)
summaryAllValues$participant <- as.factor(summaryAllValues$participant)

summaryAllValues$trialCorrect <- formatC(summaryAllValues$trialCorrect, digits = 2, format = "f")
summaryAllValues$trialCorrect<-as.numeric(summaryAllValues$trialCorrect)
summaryAllValues$preTouchScreen <- as.factor(summaryAllValues$preTouchScreen)
head(summaryAllValues)

#ACCRaw <- ggplot(data=summaryAllValues, 
#       aes(Group, trialCorrect, group=participant, colour=preTouchScreen)) + 
#  geom_point() + 
#  geom_line() + 
#  theme_classic() +
#  geom_hline(yintercept=.5, linetype="dashed")

#ACCRaw


#summaryAllValues
summaryAllValues$participant[summaryAllValues$trialCorrect<0.5]


taskData<- taskData[!taskData$participant=="168",] #These subjects ahve low accuracty due to anticipatory responses
taskData<- taskData[!taskData$participant=="193",]#These subjects ahve low accuracty due to anticipatory responses

#Taking out trials that are anticipatory and incorrect - as if it was a mistake touch 

#This subject has .13-.25 for accuracy 
#taskData <- taskData[!taskData$participant=="98",] 


taskData$trialCorrect[(taskData$keyResponseTime1 < taskData$stimulusPresent.t & taskData$correctKey==taskData$keyResponse1)] <-1

taskDatawithAntic <- taskData[!(taskData$anticipatoryResponse==1 & taskData$trialCorrect==0),]
head(taskData[(taskData$anticipatoryResponse==1 & taskData$trialCorrect==0),])

summaryAllValues <- taskDatawithAntic %>% 
  group_by(participant, Group) %>%
  summarise_at(vars(trialCorrect), funs(mean(., na.rm=TRUE)))

summaryAllValues <- as.data.frame(summaryAllValues)
summaryAllValues$participant <- as.factor(summaryAllValues$participant)

summaryAllValues$trialCorrect <- formatC(summaryAllValues$trialCorrect, digits = 2, format = "f")
summaryAllValues$trialCorrect <- as.numeric(summaryAllValues$trialCorrect)

ACC <- ggplot(data=summaryAllValues, aes(Group, trialCorrect, group=participant, colour=participant)) +
  #theme_minimal()  + 
  theme_classic() +
  geom_point() + 
  geom_line()+ 
  geom_hline(yintercept = c(0.5), linetype="dotted") + 
  labs(title="ACC (excluding incorrect anticipatory responses)",
        x ="Block (time)", y = "ACC") +
  theme(legend.position = "none")
  
ACC

head(taskData)
```




```{r}
#Taking out subjects who on the last trial had accuracy of below 50% 

taskData<- taskData[!taskData$participant=="140",]
taskData<- taskData[!taskData$participant=="164",]
taskData<- taskData[!taskData$participant=="175",]

taskDatawithAntic<- taskDatawithAntic[!taskDatawithAntic$participant=="140",]
taskDatawithAntic<- taskDatawithAntic[!taskDatawithAntic$participant=="164",]
taskDatawithAntic<- taskDatawithAntic[!taskDatawithAntic$participant=="175",]
(taskDatawithAntic)

unique(taskData$participant)
summaryAllValues <- taskDatawithAntic %>% 
  group_by(participant, Group) %>%
  summarise_at(vars(trialCorrect), funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summaryAllValues <- as.data.frame(summaryAllValues)
summaryAllValues$participant <- as.factor(summaryAllValues$participant)


summaryAllValues$trialCorrect <- formatC(summaryAllValues$mean, digits = 2, format = "f")
summaryAllValues$trialCorrect <- as.numeric(summaryAllValues$mean)

ACC <- ggplot(data=summaryAllValues, aes(Group, trialCorrect, group=participant, colour=participant)) +
  #theme_minimal()  + 
  theme_classic() +
  geom_point() + 
  geom_line()+
  geom_hline(yintercept =0.5, linetype="dotted") + 
  theme(legend.title = element_blank()) +
  labs(title="ACC (excluding incorrect anticipatory responses)",
        x ="Block (time)", y = "ACC") +
  theme(legend.position = "none")

#+ facet_wrap("participant")
ACC
#ggsave("ACCdata06.13.2018.png", plot=ACC, height=5, width = 8)

ACC <- ggplot(data=summaryAllValues, aes(Group, trialCorrect, group=participant, colour=participant)) +
  #theme_minimal()  + 
  theme_classic() +
  geom_point() + 
  geom_line()+
  geom_hline(yintercept =0.5, linetype="dotted") + 
  theme(legend.title = element_blank()) + #taking off legend / colors 
  labs(title="ACC (excluding incorrect anticipatory responses)",
        x ="Block (time)", y = "ACC") +
  theme(legend.position = "none")

#+ facet_wrap("participant")
ACC

require(gridExtra)
plot1 <- ACCRaw
plot1
plot2 <- ACC
#plot3<- ACCnoAntic

grid.arrange(plot1, plot2, nrow=2)

#grid.arrange(plot1, plot2, plot3, nrow=3)

#ggsave("ACCdata09.22.2018.png", plot=grid.arrange(plot1, plot2, nrow=2), height=8, width = 8)

```




## Response TImes 

```{r}
#taskData[taskData$participant==100,]
taskDataCorrect <- taskData[which(taskData$trialCorrect==1),]
length(unique(taskDataCorrect$participant))

options(digits=5)
#View(taskDataCorrect)

summaryAllValues <- taskDataCorrect %>% 
  group_by(participant, Group) %>%
  summarise_at(vars(responseTimeCorrect),funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summaryAllValues <- as.data.frame(summaryAllValues)
summaryAllValues$participant <- as.factor(summaryAllValues$participant)


RTCorrect <- ggplot(data=summaryAllValues, 
          aes(Group, mean, group=participant, colour=participant)) +
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=0.2) +  
  geom_point() + 
  geom_line() + 
  theme_bw() + 
  labs(title="RT (correct trials only)",
        x ="Block (time)", y = "RT")+
  theme(legend.position = "none")
RTCorrect



#ggsave("RTdata09.22.2018.png", plot=RTCorrect, height=5, width = 8)
require(gridExtra)
options(digits=2)
Both <- grid.arrange(ACC, RTCorrect, nrow=2)
#ggsave("RTandACCdata09.22.2018.png", plot=Both, height=5, width = 8)

Both
#write.table(taskData, file = "dataCleaned09.22.2018.csv", row.names = F,
#            col.names = T, sep = ",")

```

## normalizing RT all (with incorrect)

```{r}
summaryAllValues <- taskData %>% 
  group_by(participant, Group) %>%
  summarise_at(vars(responseTimeCorrect),funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summaryAllValues <- as.data.frame(summaryAllValues)
summaryAllValues$participant <- as.factor(summaryAllValues$participant)


summarySubjectRT <- taskData %>% 
  group_by(participant) %>%
  summarise_at(vars(responseTimeCorrect), funs(mean(., na.rm=TRUE)))
normalizing <- merge(summarySubjectRT, summaryAllValues, by="participant")
#normalizing$normalizedValues <- normalizing$responseTimeCorrect.y/normalizing$responseTimeCorrect.x

normalizing$normalizedValues <- normalizing$mean/normalizing$responseTimeCorrect
head(normalizing)
library(ggplot2)

normalizing$participant <- as.factor(normalizing$participant)
normalizing <- normalizing[!normalizing$participant=="121",]

RT <- ggplot(data=normalizing, 
          aes(Group, normalizedValues, group=participant, colour=participant)) +
  geom_point() + 
  geom_line() + 
  theme_bw() +
  labs(title="RT (all trials)",
        x ="Block (time)", y = "Normalized RT")+
  theme(legend.position = "none")
RT


summaryAllValues <- normalizing %>% 
  group_by(Group) %>%
  summarise_at(vars(normalizedValues), funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summaryAllValues$participant <- 1

head(normalizing)
#View(taskData)

AverageRT <- ggplot(data=normalizing, aes(Group, normalizedValues)) + 
  geom_point(aes(group=participant, color=participant)) + 
  geom_line(aes(group=participant, color=participant)) + 
  geom_point(data=summaryAllValues, 
          aes(Group, mean)) +
  geom_line(data=summaryAllValues, 
          aes(Group, mean, group=participant))+
  geom_errorbar(data=summaryAllValues, 
                aes(Group, mean, ymin=mean-se, ymax=mean+se), width=0.2) +  
  theme_bw() + 
  labs(title="RT (all trials)",
        x ="Block (time)", y = "RT") + 
  theme_bw() +
  theme(legend.position = "none")
AverageRT


AverageRT <- ggplot(data=summaryAllValues, aes(Group, mean)) +
  geom_point() + 
  geom_line()+
  geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=0.2) +  
  theme_bw() + 
  labs(title="RT (all trials)",
        x ="Block (time)", y = "RT") + 
  theme_bw() 
AverageRT

#ggsave("RTNormalALL09.22.2018.png", plot=AverageRT, height=5, width = 8)

```






## NOrmalized correct trial RT 
```{r}
summaryAllValues <- taskDataCorrect %>% 
  group_by(participant, Group) %>%
  summarise_at(vars(responseTimeCorrect), funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summaryAllValues <- dplyr::rename(summaryAllValues, responseTimeCorrect=mean, responseTimeCorrect_sd=sd, responseTimeCorrect_se=se)

summaryAllValues <- as.data.frame(summaryAllValues)
summaryAllValues$participant <- as.factor(summaryAllValues$participant)

summarySubjectRT <- taskDataCorrect %>% 
  group_by(participant) %>%
  summarise_at(vars(responseTimeCorrect),funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summarySubjectRT <- dplyr::rename(summarySubjectRT, responseTimeCorrect=mean, responseTimeCorrect_sd=sd, responseTimeCorrect_se=se)



normalizing <- merge(summarySubjectRT, summaryAllValues, by="participant")

normalizing$normalizedValues <- normalizing$responseTimeCorrect.y/normalizing$responseTimeCorrect.x

library(ggplot2)


normalizing$participant <- as.factor(normalizing$participant)
normalizing <- normalizing[!normalizing$participant=="121",]

RT <- ggplot(data=normalizing, 
          aes(Group, normalizedValues, group=participant, colour=participant)) +
  geom_point() + 
  geom_line() + 
  theme_bw() +
  labs(title="RT (correct trials only)",
        x ="Block (time)", y = "Normalized RT")+
  theme(legend.position = "none")
RT

summaryAllValues <- normalizing %>% 
  group_by( Group) %>%
  summarise_at(vars(normalizedValues),funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))
summaryAllValues <- dplyr::rename(summaryAllValues, normalizedValues=mean, normalizedValues_sd=sd, normalizedValues_se=se)


summaryAllValues$participant <- 1
class(normalizing$participant)

library(ggplot2)
AverageRTNormal <- ggplot(data=normalizing, aes(Group, normalizedValues)) + 
  geom_point(aes(group=participant, color=participant)) + 
  geom_line(aes(group=participant, color=participant)) + 
  geom_point(data=summaryAllValues, aes(Group, normalizedValues, group=participant)) + 
  geom_line(data=summaryAllValues, aes(Group, normalizedValues, group=participant)) + 
  geom_errorbar(data=summaryAllValues,aes(ymin=normalizedValues-normalizedValues_sd,ymax=normalizedValues+normalizedValues_sd),width=.2)+
  theme_bw() + 
  labs(title="RT (correct trials only)",
        x ="Block (time)", y = "RT") + 
  theme_bw() +
  theme(legend.position = "none")
AverageRTNormal


#ggsave("RTNormalCorrectONLY09.22.2018.png", plot=AverageRTNormal, height=5, width = 8)

```



```{r}

normalizing$random <- ifelse(normalizing$Group=="Block1" | normalizing$Group=="Block3", 0 ,1)
#(normalizing)
summarySubjectRTRandom <- normalizing %>% 
  group_by(participant, random) %>%
  summarise_at(vars(responseTimeCorrect.y),funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summarySubjectRTRandom <- dplyr::rename(summarySubjectRTRandom, responseTimeCorrect.y=mean, responseTimeCorrect.y_sd=sd, responseTimeCorrect.y_se=se)


summaryRTRandom <- normalizing %>% 
  group_by(random) %>%
  summarise_at(vars(responseTimeCorrect.y),funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))
summaryRTRandom <- as.data.frame(summaryRTRandom)

summaryRTRandom <- dplyr::rename(summaryRTRandom, responseTimeCorrect.y=mean, responseTimeCorrect.y_sd=sd, responseTimeCorrect.y_se=se)



#summarySubjectRTRandom

#summarySubjectRTRandom$random[summarySubjectRTRandom$random==0[summarySubjectRTRandom$responseTimeCorrect.y]]

#summarySubjectRTRandom

summaryRTRandomDifference <- summarySubjectRTRandom %>% 
  group_by(participant) %>%
  summarise_at(vars(responseTimeCorrect.y), funs(sum(., na.rm=TRUE)))
summaryRTRandomDifference <- as.data.frame(summaryRTRandom)
#summaryRTRandomDifference

RTRandom <- ggplot(data=summarySubjectRTRandom, 
          aes(random, responseTimeCorrect.y)) +
  geom_point(aes(group=participant, colour=participant)) +
  geom_line(aes(group=participant, colour=participant)) + 
  geom_point(data=summaryRTRandom, aes(random, responseTimeCorrect.y), colour='black', size=4) + 
  #geom_line(data=summaryRTRandom, aes(random, keyResponseTime1.y), colour='black') + 
  theme_bw() +
  labs(title="RT (correct trials only)",
        x ="Block (time)", y = "Normalized RT") +
  theme(legend.position = "none") #+ 
  #facet_wrap("participant")
RTRandom

summaryAllValues <- normalizing %>% 
  group_by(Group) %>%
  summarise_at(vars(normalizedValues), funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))
#summaryAllValues
summaryAllValues$participant <- 1

head(summaryAllValues)

```


```{r}

require(gridExtra)
plot1 <- AverageRTNormal
plot2 <- AverageRT
grid.arrange(plot1, plot2, nrow=2)

#ggsave("RTNormalBOTH09.22.2018.png", plot=grid.arrange(plot1, plot2, nrow=2)
#, height=8, width = 8)

```


```{r}

#View(questionsResponsesTouch)
correctRecall <- questionsResponsesTouch %>% 
  group_by(participant) %>%
  summarise_at(vars(trialCorrect), funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

#COMBO OF RECAL AND RECOG 


recogData <- questionsResponsesTouch[questionsResponsesTouch$trials_recogtest.thisN==0,]

correctRecog <- recogData %>% 
  group_by(participant) %>%
  summarise_at(vars(trialCorrect),funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))
head(correctRecog)

ggplot(data=correctRecog, aes(participant, mean)) + geom_point() + geom_hline(yintercept=0.5, linetype="dotted")



recallData <- questionsResponsesTouch[!questionsResponsesTouch$trials_recogtest.thisN==0,]

#View(recallData)
ggplot(data=correctRecall, aes(participant, mean)) + 
  geom_point() + 
  geom_hline(yintercept=0.5, linetype="dotted")

ggplot(data=correctRecall, aes(participant, mean)) + 
  geom_point() + 
  geom_hline(yintercept=0.5, linetype="dotted")

```




#Adding Age From Inventory 


```{r}
#inventory <- as.data.frame(read.csv("sequenceLearningInventory12.15.18.csv"))
inventory <- as.data.frame(read.csv("MASTER_20190722.csv"))


subsetInvent <- subset(inventory, select=c("IDENT_SUBID", "IDENT_SUBTYPE", "SUBAGE_Session1"))

#View(taskData)
#View(subsetInvent)

subsetInvent$participant[1:length(subsetInvent$IDENT_SUBID)] <- gsub("PA", "", 1:length(subsetInvent$IDENT_SUBID), subsetInvent$IDENT_SUBID)

class(taskData$participant)
class(subsetInvent$participant)

taskData$participant <- as.integer(taskData$participant)
subsetInvent$participant <- as.integer(subsetInvent$participant)

#View(fullData) 
fullData <- merge(normalizing, subsetInvent, by="participant")

length(unique(fullData$participant))

summaryAllValues <- fullData %>% 
  group_by(participant, IDENT_SUBTYPE) %>%
  summarise_at(vars(responseTimeCorrect.x), funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

summaryAllValues <- as.data.frame(summaryAllValues)
summaryAllValues$participant <- as.factor(summaryAllValues$participant)

#fullData$Age <- as.numeric(fullData$Age)
#fullData$AgeRounded <- round(fullData$Age, digits = 0)
#fullData$AgeRounded <- as.factor(fullData$AgeRounded)

head(fullData)
length(fullData$participant)
class(fullData$Age_years)


RTbyAge <- ggplot(data=fullData, 
          aes(IDENT_SUBTYPE, normalizedValues, group=participant, colour=SUBAGE_Session1)) +
  geom_point(aes(IDENT_SUBTYPE, normalizedValues, group=participant, colour=SUBAGE_Session1)) + 
  geom_line(aes(group=participant))+
  theme_bw() + 
  labs(title="RT (correct trials only)",
        x ="Block (time)", y = "RT") + 
   scale_colour_gradientn(colours=c("red", "blue"))
RTbyAge

fullData$Age_years <- round(fullData$SUBAGE_Session1)

RTbyAge <- ggplot(data=fullData, 
          aes(IDENT_SUBTYPE, normalizedValues, group=participant, colour=Age_years)) +
  geom_point() +
  geom_line() + 
  theme_bw() + 
  labs(title="RT (correct trials only)",
        x ="Block (time)", y = "RT") + 
  #scale_colour_gradientn(colours=c("red", "blue")) + 
  facet_wrap("Age_years")
RTbyAge


```




```{r}

#fullData$Group.y <- as.numeric(fullData$Group.y)
#fullData$Group.y[fullData$Group.y=="NA"]<-0
RTbyAge <- ggplot(data=fullData, 
          aes(IDENT_SUBTYPE, normalizedValues, group=participant)) +
  geom_point(aes(colour=Group.y)) + 
  geom_line(aes(colour=Group.y)) + 
  theme_bw() + 
  labs(title="RT (correct trials only)",
        x ="Block (time)", y = "RT") + 
   scale_colour_gradientn(colours=c("red", "blue")) + 
  facet_wrap("Age_years")
RTbyAge

class(fullData$Group.y)
fullData$Group.y<- as.factor(fullData$Group.y)
RTbyAgeDiscrete <- ggplot(data=fullData, 
          aes(Group.x, normalizedValues, group=participant, colour=Group.y)) +
  geom_point() + 
  geom_line() + 
  theme_bw() + 
  labs(title="RT (correct trials only)",
        x ="Block (time)", y = "RT")+
  theme_bw() 
RTbyAgeDiscrete

RTbyAgeDiscrete <- ggplot(data=fullData, 
          aes(Group.x, normalizedValues, group=participant, colour=Group.y)) +
  geom_point() + 
  geom_line() + 
  theme_bw() + 
  labs(title="RT (correct trials only)",
        x ="Block (time)", y = "RT")+
  theme_bw()  + 
  facet_wrap("Group.y")
RTbyAgeDiscrete

frequencies <- as.data.frame(count(fullData$Group.y))

add_count(fullData$Age_years)
tally(fullData$Group.y))


frequencies$Freq <- frequencies$freq/4
frequencies
head(fullData)
ages <- as.data.frame(count(fullData$Age_years))
ages 
(count(fullData$Age_years), count(fullData$Group.y))

summaryAllValues <- fullData %>% 
  summarise(group_by(fullData,Group.y,Age_years),count =n())


frequencies$Freq <- frequencies$freq/4
frequencies

data %>% group_by(group,size) %>% tally()

summaryAllValues <- fullData %>% 
  group_by(Group.y, Age_years) %>%
  tally()
summaryAllValues <- as.data.frame(summaryAllValues)
summaryAllValues



ggplot(summaryAllValues, aes(Age_years, n, group=Group.y, color=Group.y))+ 
  theme_classic()+
  geom_point() + 
  geom_line()

summaryAllValues$Group <- ifelse(summaryAllValues$Group.y==0, "Comp", "DC")


summaryAllValues
head(fullData)
fullData$Group <- ifelse(fullData$Group.y==0, "Comp", "DC")


summaryAllValues <- fullData %>% 
  group_by(Group, Age_years) %>%
  tally()
summaryAllValues

ggplot(summaryAllValues, aes(Age_years, n, group=Group, color=Group))+ 
  theme_bw()+
  geom_point() + 
  geom_line()



summaryAllValues <- fullData %>% 
  group_by(Group.x, Group.y) %>%
  summarise_at(vars(normalizedValues),funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))
summaryAllValues <- as.data.frame(summaryAllValues)
summaryAllValues

ggplot(data=summaryAllValues, aes(Group.x, normalizedValues, group=Group.y, color=Group.y)) + 
  theme_classic()+
  geom_point() + 
  geom_line()



#ggsave("RTbyAge05.16.2018.png", plot=RTbyAgeDiscrete, height=5, width = 8)
```



```{r}
summaryAllValuesACC <- taskData %>% 
  group_by(participant, Group) %>%
  summarise_at(vars(trialCorrect), funs(mean(., na.rm=TRUE), sd(., na.rm=T),se=sd/sqrt(n())))

fullDataACC <- merge(summaryAllValuesACC, subsetData, by="participant")

#fullDataACC$Age <- as.numeric(fullDataACC$Age)
#fullDataACC$AgeRounded <- round(fullDataACC$Age, digits = 0)
#fullDataACC$AgeRounded <- as.factor(fullDataACC$AgeRounded)
fullDataACC$Age_years <- as.factor(fullDataACC$Age_years)
class(fullDataACC$Age_years)
ACC <- ggplot(data=fullDataACC, aes(Group.x, trialCorrect, group=participant, colour=Age_years)) +
  geom_point() + 
  geom_line()+ 
  theme_bw() +
  geom_hline(yintercept = c(0.5), linetype="dotted") + 
  labs(title="ACC (including anticipatory responses)",
        x ="Block (time)", y = "ACC") +
  scale_color_brewer(palette="RdGy")
ACC

ACC <- ggplot(data=fullDataACC, aes(Group.x, trialCorrect, group=participant, colour=Age_years)) +
  geom_point() + 
  geom_line()+ 
  theme_bw() +
  geom_hline(yintercept = c(0.5), linetype="dotted") + 
  labs(title="ACC (including anticipatory responses)",
        x ="Block (time)", y = "ACC") +
  scale_color_brewer(palette="RdGy") + 
  facet_wrap("Age_years")
ACC

head(fullDataACC)
ACC <- ggplot(data=fullDataACC, aes(Group.x, trialCorrect, group=participant, colour=Group.x)) +
  geom_point() + 
  geom_line()+ 
  theme_bw() +
  geom_hline(yintercept = c(0.5), linetype="dotted") + 
  labs(title="ACC (including anticipatory responses)",
        x ="Block (time)", y = "ACC") +
  scale_color_brewer(palette="RdGy") + 
  facet_wrap("Group.x")
ACC

#Both <- grid.arrange(RTbyAge, ACC, nrow=2)
#ggsave("RTandACCdata05.17.2018.png", plot=Both, height=8, width = 8)

````
Adding Group 


```{r}
Group <- read.csv("sequenceLearningInventory12.15.18.csv")

```





